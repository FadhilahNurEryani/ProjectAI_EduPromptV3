// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String
  passwordHash String?  @map("password_hash")
  role         String   @default("teacher")
  institution  String?
  subject      String?
  gradeLevel   String?  @map("grade_level")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  createdTemplates PromptTemplate[]
  generatedPrompts GeneratedPrompt[]
  favorites        Favorite[]
  analytics        UsageAnalytics[]
  feedbacks        Feedback[]

  @@map("users")
}

model Category {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  icon        String?
  sortOrder   Int      @default(0) @map("sort_order")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")

  templates PromptTemplate[]

  @@map("categories")
}

model PromptTemplate {
  id            String   @id @default(uuid())
  categoryId    String   @map("category_id")
  title         String
  description   String?
  promptTemplate String  @map("prompt_template")
  variables     Json?
  exampleOutput String?  @map("example_output")
  tags          String[]
  difficulty    String?
  estimatedTime Int?     @map("estimated_time")
  isFeatured    Boolean  @default(false) @map("is_featured")
  isActive      Boolean  @default(true) @map("is_active")
  usageCount    Int      @default(0) @map("usage_count")
  createdBy     String?  @map("created_by")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  category         Category          @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  creator          User?             @relation(fields: [createdBy], references: [id])
  generatedPrompts GeneratedPrompt[]
  favorites        Favorite[]
  analytics        UsageAnalytics[]
  feedbacks        Feedback[]

  @@index([categoryId])
  @@index([isActive])
  @@index([isFeatured])
  @@map("prompt_templates")
}

model GeneratedPrompt {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  templateId     String?  @map("template_id")
  inputData      Json     @map("input_data")
  generatedPrompt String  @map("generated_prompt")
  title          String?
  isFavorite     Boolean  @default(false) @map("is_favorite")
  isArchived     Boolean  @default(false) @map("is_archived")
  createdAt       DateTime @default(now()) @map("created_at")

  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  template PromptTemplate? @relation(fields: [templateId], references: [id])

  @@index([userId])
  @@map("generated_prompts")
}

model Favorite {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  templateId String   @map("template_id")
  createdAt  DateTime @default(now()) @map("created_at")

  user     User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  template PromptTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([userId, templateId])
  @@map("favorites")
}

model UsageAnalytics {
  id         String   @id @default(uuid())
  userId     String?  @map("user_id")
  templateId String?  @map("template_id")
  action     String
  metadata   Json?
  createdAt  DateTime @default(now()) @map("created_at")

  user     User?          @relation(fields: [userId], references: [id])
  template PromptTemplate? @relation(fields: [templateId], references: [id])

  @@index([userId])
  @@index([createdAt])
  @@map("usage_analytics")
}

model Feedback {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  templateId String   @map("template_id")
  rating     Int
  comment    String?
  createdAt  DateTime @default(now()) @map("created_at")

  user     User          @relation(fields: [userId], references: [id])
  template PromptTemplate @relation(fields: [templateId], references: [id])

  @@map("feedback")
}






